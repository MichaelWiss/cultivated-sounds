<div class="min-h-screen bg-vinyl-paper">
  {%- paginate blog.articles by section.settings.posts_per_page -%}
    <!-- Header Section -->
    <div class="border-b border-vinyl-blue px-4 sm:px-8 bg-vinyl-paper relative overflow-hidden" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
      <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
        <h1 class="text-9xl font-serif italic text-vinyl-blue opacity-20">{{ blog.title | truncatewords: 1, '' }}</h1>
      </div>
      
      <div class="max-w-4xl relative z-10">
        <p class="font-mono text-xs uppercase tracking-widest text-vinyl-blue mb-4">
          {{ 'sections.blog.title' | t }}
        </p>
        <h1 class="font-serif text-5xl sm:text-7xl text-vinyl-black italic mb-6 leading-[0.9]">
          {{ blog.title }}
        </h1>
        {%- if section.settings.show_description and blog.metafields.custom.description != blank -%}
          <div class="font-sans text-lg text-gray-600 max-w-xl leading-relaxed">
            {{ blog.metafields.custom.description }}
          </div>
        {%- endif -%}
      </div>
    </div>

    <!-- Tag Filter Bar -->
    {%- if blog.all_tags.size > 0 -%}
      <div class="sticky top-[64px] sm:top-[80px] z-30 bg-vinyl-paper border-b border-vinyl-blue py-3 px-4 sm:px-8 flex flex-wrap gap-2 items-center">
        <span class="font-mono text-xs uppercase text-gray-500 mr-2">{{ 'sections.blog.filter_label' | t }}</span>
        <a 
          href="{{ blog.url }}" 
          class="font-mono text-xs uppercase px-3 py-1 border transition-colors {% if current_tags == blank %}bg-vinyl-blue text-white border-vinyl-blue{% else %}border-vinyl-blue text-vinyl-blue hover:bg-vinyl-blue hover:text-white{% endif %}"
        >
          {{ 'sections.blog.all_tags' | t }}
        </a>
        {%- for tag in blog.all_tags -%}
          <a 
            href="{{ blog.url }}/tagged/{{ tag | handle }}" 
            class="font-mono text-xs uppercase px-3 py-1 border transition-colors {% if current_tags contains tag %}bg-vinyl-blue text-white border-vinyl-blue{% else %}border-vinyl-blue text-vinyl-blue hover:bg-vinyl-blue hover:text-white{% endif %}"
          >
            {{ tag }}
          </a>
        {%- endfor -%}
      </div>
    {%- endif -%}

    <!-- Articles Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 border-l border-vinyl-blue min-h-[50vh]">
      {%- for article in blog.articles -%}
        <article class="border-r border-b border-vinyl-blue group">
          {%- if section.settings.show_featured_image and article.image -%}
            <a href="{{ article.url }}" class="block aspect-[4/3] overflow-hidden bg-gray-100">
              <img
                src="{{ article.image | image_url: width: 800 }}"
                alt="{{ article.image.alt | escape }}"
                width="{{ article.image.width }}"
                height="{{ article.image.height }}"
                loading="lazy"
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
              >
            </a>
          {%- endif -%}
          
          <div class="p-6">
            {%- if section.settings.show_date or section.settings.show_author -%}
              <div class="flex items-center gap-3 mb-3">
                {%- if section.settings.show_date -%}
                  <time 
                    datetime="{{ article.published_at | date: '%Y-%m-%d' }}" 
                    class="font-mono text-xs uppercase text-gray-500"
                  >
                    {{ article.published_at | date: '%B %d, %Y' }}
                  </time>
                {%- endif -%}
                {%- if section.settings.show_date and section.settings.show_author -%}
                  <span class="text-gray-300">•</span>
                {%- endif -%}
                {%- if section.settings.show_author -%}
                  <span class="font-mono text-xs uppercase text-gray-500">
                    {{ article.author }}
                  </span>
                {%- endif -%}
              </div>
            {%- endif -%}

            <h2 class="font-serif text-2xl text-vinyl-black italic mb-3 leading-tight">
              <a href="{{ article.url }}" class="hover:text-vinyl-blue transition-colors">
                {{ article.title }}
              </a>
            </h2>

            {%- if article.excerpt.size > 0 -%}
              <p class="font-sans text-gray-600 text-sm leading-relaxed mb-4 line-clamp-3">
                {{ article.excerpt | strip_html | truncate: 150 }}
              </p>
            {%- endif -%}

            <a 
              href="{{ article.url }}" 
              class="inline-flex items-center font-mono text-xs uppercase tracking-widest text-vinyl-blue hover:underline"
            >
              {{ 'sections.blog.read_more' | t }}

              <span class="ml-2">→</span>
            </a>
          </div>
        </article>
      {%- else -%}
        <div class="col-span-full py-24 text-center">
          <p class="font-mono text-gray-400">No articles found.</p>
        </div>
      {%- endfor -%}
    </div>

    {%- if paginate.pages > 1 -%}
      <div class="py-12 flex justify-center border-t border-vinyl-blue">
        {% render 'pagination', paginate: paginate %}
      </div>
    {%- endif -%}
  {%- endpaginate -%}
</div>

{% schema %}
{
  "name": "Blog Posts",
  "tag": "section",
  "class": "section-main-blog",
  "settings": [
    {
      "type": "range",
      "id": "posts_per_page",
      "min": 6,
      "max": 24,
      "step": 3,
      "default": 12,
      "label": "Posts per page"
    },
    {
      "type": "checkbox",
      "id": "show_featured_image",
      "default": true,
      "label": "Show featured image"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "default": true,
      "label": "Show date"
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "default": false,
      "label": "Show author"
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "default": true,
      "label": "Show blog description"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 64
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 64
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
