{% comment %}
  Main Product Section
  - Ported from ProductDetail.tsx and ProductForm.tsx
  - Uses Tailwind CSS for styling
{% endcomment %}

<section class="bg-vinyl-paper min-h-screen pb-32" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
  
  {% comment %} Breadcrumb / Back {% endcomment %}
  <div class="border-b border-vinyl-blue px-4 sm:px-8 py-3 flex items-center justify-between sticky top-[64px] sm:top-[80px] z-30 bg-vinyl-paper">
    <a href="{{ routes.all_products_collection_url }}" class="flex items-center gap-2 font-mono text-[10px] uppercase tracking-[0.2em] text-vinyl-blue hover:text-black transition-colors">
      ← BACK TO SHOP
    </a>
    <div class="hidden sm:flex gap-4 font-mono text-[10px] text-gray-400 uppercase tracking-widest">
       <span>CATALOG: {{ product.metafields.my_fields.catalog_number | default: 'ST-202' }}</span>
       <span class="text-vinyl-blue/30">/</span>
       <span>{{ product.vendor | default: 'YOUNG ART RECORDS' }}</span>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 min-h-[calc(100vh-140px)]">
    
    {% comment %} Left Column: Media (Sticky) {% endcomment %}
    <div class="lg:col-span-7 border-b lg:border-b-0 lg:border-r border-vinyl-blue relative">
        <product-gallery class="lg:sticky lg:top-[140px] h-auto lg:h-[calc(100vh-140px)] overflow-hidden flex flex-col">
            <div class="flex-1 bg-gray-100 relative group overflow-hidden border-b border-vinyl-blue">
                {% if product.featured_media %}
                  <img 
                      src="{{ product.featured_media | image_url: width: 1200 }}" 
                      alt="{{ product.featured_media.alt | escape }}" 
                      width="{{ product.featured_media.width }}"
                      height="{{ product.featured_media.height }}"
                      class="pdp-main-image w-full h-full object-cover transition-transform duration-[4s] ease-in-out hover:scale-105"
                      data-product-main-image
                  >
                {% endif %}
                <div class="absolute bottom-6 left-6 right-6 flex justify-between items-end opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                     <button class="bg-vinyl-paper px-3 py-1 text-[10px] font-mono uppercase tracking-widest border border-vinyl-blue shadow-sm text-vinyl-blue">
                        View Hi-Res
                     </button>
                </div>
            </div>
            {% comment %} Secondary Images Strip {% endcomment %}
            <div class="flex overflow-x-auto divide-x-0 border-t border-vinyl-blue no-scrollbar">
                 {% for media in product.media %}
                   <div 
                     class="w-1/4 aspect-square flex-shrink-0 relative cursor-pointer border-r border-vinyl-blue group/thumb"
                     data-thumbnail-index="{{ forloop.index0 }}"
                     data-image-url="{{ media | image_url: width: 1200 }}"
                   >
                      <img src="{{ media | image_url: width: 400 }}" class="w-full h-full object-cover grayscale group-hover/thumb:grayscale-0 transition-all duration-500" alt="{{ media.alt | escape }}">
                      {% if forloop.first %}
                        <div class="absolute inset-x-0 bottom-0 h-1 bg-vinyl-blue"></div>
                      {% endif %}
                   </div>
                 {% endfor %}
                 
                 {% comment %} Audio/Video Placeholder Thumbnail {% endcomment %}
                 <div class="w-1/4 aspect-square flex-shrink-0 relative cursor-pointer border-r border-vinyl-blue bg-vinyl-black flex items-center justify-center group/thumb">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white group-hover/thumb:scale-110 transition-transform"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
                 </div>

                 {% comment %} Back Cover Placeholder Thumbnail {% endcomment %}
                 <div class="w-1/4 aspect-square flex-shrink-0 relative cursor-pointer border-r border-vinyl-blue bg-[#e0e4ff] flex flex-col items-center justify-center px-2 group/thumb">
                    <span class="font-mono text-[8px] text-vinyl-blue font-bold tracking-tighter text-center uppercase leading-none">Back Cover</span>
                 </div>
            </div>
        </product-gallery>
    </div>

    {% comment %} Right Column: Details (Scrollable) {% endcomment %}
    <div class="lg:col-span-5 bg-vinyl-paper">
        <div class="p-6 sm:p-10 lg:p-12 flex flex-col gap-10">
            
            {%- for block in section.blocks -%}
              {%- case block.type -%}
                {%- when '@app' -%}
                  {% render block %}
                
                {%- when 'title' -%}
                  <div class="pdp-animate-up" {{ block.shopify_attributes }}>
                      <div class="flex flex-col gap-1 mb-6 font-mono text-[10px] uppercase tracking-[0.2em]">
                          <span class="text-vinyl-blue font-bold">LABEL: {{ product.vendor | default: 'YOUNG ART RECORDS' }}</span>
                          <span class="text-gray-400">REL: {{ product.published_at | date: "%m.%d.%y" }} | {{ product.tags | join: ' / ' | upcase }}</span>
                      </div>
                      
                      <h1 class="flex flex-col">
                          <span class="block text-vinyl-black mb-1 text-2xl sm:text-3xl font-bold tracking-tight">{{ product.metafields.my_fields.artist | default: 'Rochelle Jordan' }} —</span>
                          <span class="font-serif text-5xl sm:text-6xl lg:text-7xl text-vinyl-blue italic leading-[0.9]">{{ product.title }}</span>
                      </h1>
                  </div>

                {%- when 'price' -%}
                  <div class="pdp-animate-up mt-8 flex items-center gap-6" {{ block.shopify_attributes }}>
                      <span class="font-mono text-3xl font-bold text-vinyl-black">{{ product.price | money }}</span>
                      {% if product.available == false %}
                         <span class="px-4 py-1.5 border border-gray-400 text-gray-400 text-[10px] font-mono uppercase tracking-[0.2em]">{{ 'products.product.sold_out' | t }}</span>
                      {% elsif product.tags contains 'New' %}
                         <span class="px-4 py-1.5 bg-vinyl-blue/5 border border-vinyl-blue text-vinyl-blue text-[10px] font-mono uppercase tracking-[0.2em] rounded-full">NEW ARRIVAL</span>
                      {% endif %}
                  </div>

                {%- when 'variant_picker' -%}
                  <div class="pdp-animate-up mt-12" {{ block.shopify_attributes }}>
                     <product-form>
                       {% form 'product', product, id: 'product-form-installation', class: 'product-form flex flex-col gap-8' %}
                         <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                         
                         {% unless product.has_only_default_variant %}
                           <div class="flex flex-col gap-3">
                             <span class="font-mono text-[9px] uppercase text-gray-400 tracking-[0.2em]">FORMAT</span>
                             <div class="flex flex-wrap gap-2">
                                {% for variant in product.variants %}
                                  <div class="relative">
                                    <input 
                                      type="radio" 
                                      name="id" 
                                      value="{{ variant.id }}" 
                                      id="variant-{{ variant.id }}"
                                      class="peer sr-only"
                                      {% if product.selected_or_first_available_variant.id == variant.id %}checked{% endif %}
                                    >
                                    <label 
                                      for="variant-{{ variant.id }}"
                                      class="block px-6 py-2 border font-mono text-[10px] uppercase tracking-widest transition-all cursor-pointer
                                             peer-checked:bg-vinyl-blue peer-checked:text-white peer-checked:border-vinyl-blue
                                             bg-gray-100 border-transparent text-gray-500 hover:border-vinyl-blue"
                                    >
                                        {{ variant.title }}
                                    </label>
                                  </div>
                                {% endfor %}
                             </div>
                           </div>
                         {% endunless %}

                         <div class="flex gap-4">
                              {% comment %} Quantity {% endcomment %}
                              <div class="flex items-center border border-vinyl-blue h-14 w-36 bg-white shadow-[4px_4px_0px_0px_rgba(26,35,219,0.1)]">
                                  <button type="button" class="w-12 h-full flex items-center justify-center hover:bg-gray-100 text-vinyl-blue" onclick="this.nextElementSibling.stepDown()">
                                      <span class="text-xl font-mono">-</span>
                                  </button>
                                  <input 
                                      type="number" 
                                      name="quantity" 
                                      value="1" 
                                      min="1"
                                      class="w-full h-full text-center font-mono text-sm border-x border-gray-100 focus:outline-none appearance-none" 
                                  >
                                  <button type="button" class="w-12 h-full flex items-center justify-center hover:bg-gray-100 text-vinyl-blue" onclick="this.previousElementSibling.stepUp()">
                                      <span class="text-xl font-mono">+</span>
                                  </button>
                              </div>
                              
                              <button 
                                  type="submit"
                                  name="add"
                                  {% unless product.available %}disabled{% endunless %}
                                  class="flex-1 text-white transition-all h-14 flex items-center justify-center gap-3 font-mono text-[10px] uppercase tracking-[0.25em] shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] border border-transparent
                                  {% unless product.available %}bg-gray-400 cursor-not-allowed{% else %}bg-vinyl-blue hover:bg-vinyl-black{% endunless %}"
                              >
                                  <span class="loading-overlay__spinner hidden">
                                    <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                                      <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                                    </svg>
                                  </span>
                                  <span class="submit-text flex items-center gap-3 font-bold">{% if product.available %}{{ 'products.product.add_to_cart' | t }}{% else %}{{ 'products.product.sold_out' | t }}{% endif %} <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg></span>
                              </button>
                          </div>
                          
                          <div class="product-form__error-message-wrapper font-mono text-[9px] uppercase tracking-widest text-vinyl-red" role="alert" hidden data-error-wrapper>
                            <span class="product-form__error-message"></span>
                          </div>
                       {% endform %}
                     </product-form>
                     
                     <div class="flex flex-col gap-3 font-mono text-[9px] text-vinyl-blue uppercase tracking-[0.15em] mt-8 opacity-70">
                          <div class="flex items-center gap-3">
                              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="13" x="4" y="5" rx="2"/><path d="M16 2v3"/><path d="M8 2v3"/><circle cx="9" cy="14" r="2"/><circle cx="15" cy="14" r="2"/></svg>
                              <span>Free shipping on US orders over $100</span>
                          </div>
                          <div class="flex items-center gap-3">
                              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                              <span>READY TO SHIP IN 24H</span>
                          </div>
                      </div>
                  </div>

                {%- when 'description' -%}
                  <div class="pdp-animate-up prose prose-headings:font-serif prose-p:font-sans prose-p:text-sm prose-p:leading-relaxed prose-a:text-vinyl-blue text-gray-800 max-w-none" {{ block.shopify_attributes }}>
                      <h3 class="font-serif text-2xl italic text-vinyl-blue mb-4">About the Release</h3>
                      <div class="rte">
                        {{ product.description }}
                      </div>
                  </div>

                {%- when 'tracklist' -%}
                  <div class="pdp-animate-up mt-12" data-audio-player-container {{ block.shopify_attributes }}>
                       <div class="flex justify-between items-baseline border-b-2 border-vinyl-blue pb-3 mb-6">
                           <h3 class="font-serif text-2xl italic text-vinyl-blue">Tracklist</h3>
                           <span class="font-mono text-[9px] uppercase tracking-[0.2em] text-gray-400">Total Time: 44:02</span>
                       </div>
                       <div class="flex flex-col">
                           {%- assign track_letters = "A,A,A,B,B,C,C,C" | split: ',' -%}
                           {% for i in (1..8) %}
                               {%- assign letter = track_letters[forloop.index0] -%}
                               <div 
                                  class="group flex justify-between items-center py-4 border-b border-gray-100 hover:bg-white transition-colors cursor-pointer px-2 -mx-2"
                                  data-track-index="{{ forloop.index0 }}"
                                  data-audio-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"
                               >
                                   <div class="flex items-center gap-6">
                                       <span class="font-mono text-[10px] text-gray-300 w-6">{{ letter }}{{ forloop.index }}</span>
                                       <span class="font-sans text-sm tracking-tight text-gray-700 group-hover:text-vinyl-blue transition-colors">Track Name {{ forloop.index }}</span>
                                   </div>
                                   <div class="flex items-center gap-6">
                                      <span class="font-mono text-[10px] text-gray-400">04:20</span>
                                      <div class="w-6 h-6 flex items-center justify-center text-vinyl-blue opacity-0 group-hover:opacity-100 transition-opacity">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                                      </div>
                                   </div>
                               </div>
                           {% endfor %}
                       </div>
                  </div>

                {%- when 'upsell' -%}
                  <div class="pdp-animate-up bg-white p-8 border-2 border-vinyl-blue shadow-[12px_12px_0px_0px_rgba(26,35,219,1)] mt-12" {{ block.shopify_attributes }}>
                       <h4 class="font-serif text-xl italic text-vinyl-blue mb-6 tracking-wide">Cultivated Sounds Extras</h4>
                       <div class="flex gap-8">
                          <div class="w-24 h-24 bg-vinyl-paper border border-vinyl-blue/10 flex flex-col items-center justify-center flex-shrink-0">
                              <span class="font-mono text-[8px] tracking-tight text-center uppercase leading-tight font-bold text-gray-400">12" OUTER<br/>SLEEVE</span>
                          </div>
                          <div class="flex-1">
                              <p class="font-mono text-[10px] font-bold uppercase tracking-[0.15em] mb-1">12" Outer Sleeves — Dual Pocket</p>
                              <p class="font-sans text-xs text-gray-500 mb-4 leading-relaxed">Protect your investment with our premium 3mil archival sleeves. Dual pocket for lyric sheets.</p>
                              <div class="flex justify-between items-end">
                                  <span class="font-mono text-sm font-bold text-vinyl-blue">$5.99</span>
                                  <button class="text-[9px] uppercase font-bold text-vinyl-blue border-b-2 border-vinyl-blue pb-0.5 hover:text-black hover:border-black transition-colors tracking-[0.2em]">ADD EXTRA</button>
                              </div>
                          </div>
                       </div>
                  </div>
              {%- endcase -%}
            {%- endfor -%}

        </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Product Information",
  "tag": "section",
  "class": "section-product",
  "settings": [
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 0
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "presets": [
    {
      "name": "Product Information",
      "blocks": [
        {
          "type": "title"
        },
        {
          "type": "price"
        },
        {
          "type": "variant_picker"
        },
        {
          "type": "description"
        },
        {
          "type": "tracklist"
        },
        {
          "type": "upsell"
        }
      ]
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "Variant Picker",
      "limit": 1
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "tracklist",
      "name": "Tracklist",
      "limit": 1
    },
    {
      "type": "upsell",
      "name": "Upsell",
      "limit": 1
    }
  ]
}
{% endschema %}