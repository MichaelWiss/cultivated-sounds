{% comment %}
  Collection Grid Section
  - Ported from CollectionPage.tsx
  - Uses Tailwind CSS
{% endcomment %}

{% paginate collection.products by section.settings.products_per_page %}

<section class="min-h-screen bg-vinyl-paper">
  
  {% comment %} Header Section {% endcomment %}
  <div class="border-b border-vinyl-blue py-16 sm:py-24 px-4 sm:px-8 bg-vinyl-paper relative overflow-hidden">
    <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
        <h1 class="text-9xl font-serif italic text-vinyl-blue opacity-20" aria-hidden="true">
          {{ collection.title | split: ' ' | first }}
        </h1>
    </div>
    
    <div class="max-w-4xl relative z-10">
        {% if section.settings.show_subtitle and collection.metafields.my_fields.subtitle %}
            <p class="collection-header-text font-mono text-xs uppercase tracking-widest text-vinyl-blue mb-4">
                {{ collection.metafields.my_fields.subtitle }}
            </p>
        {% endif %}
        <h1 class="collection-header-text font-serif text-5xl sm:text-7xl text-vinyl-black italic mb-6 leading-[0.9]">
            {{ collection.title }}
        </h1>
        {% if collection.description != blank %}
            <div class="collection-header-text font-sans text-lg text-gray-600 max-w-xl leading-relaxed rte">
                {{ collection.description }}
            </div>
        {% endif %}
    </div>
  </div>

  {% comment %} Filter / Sort Bar Stub {% endcomment %}
  <div class="sticky top-[64px] sm:top-[80px] z-30 bg-vinyl-paper border-b border-vinyl-blue py-3 px-4 sm:px-8 flex justify-between items-center">
     <span class="font-mono text-xs uppercase text-gray-500">{{ collection.products_count }} Items</span>
     <div class="flex items-center gap-2">
        <span class="font-mono text-xs uppercase text-gray-500">Sort:</span>
        <select id="SortBy" class="font-mono text-xs uppercase text-vinyl-blue font-bold cursor-pointer bg-transparent border-none focus:ring-0 pr-8" onchange="location.href='?sort_by='+this.value">
          {% for option in collection.sort_options %}
            <option value="{{ option.value }}" {% if option.value == collection.sort_by %}selected{% endif %}>{{ option.name }}</option>
          {% endfor %}
        </select>
     </div>
  </div>

  {% comment %} Product Grid {% endcomment %}
  <div class="collection-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 border-l border-vinyl-blue min-h-[50vh]">
    {% for product in collection.products %}
        <div class="collection-item">
            {% render 'card-product', product: product %}
        </div>
    {% else %}
        <div class="col-span-full py-24 text-center">
            <p class="font-mono text-gray-400">No items found in this collection.</p>
        </div>
    {% endfor %}
  </div>

  {% comment %} Pagination {% endcomment %}
  {% if paginate.pages > 1 %}
    <div class="py-16 flex justify-center border-b border-vinyl-blue">
        <nav role="navigation" aria-label="Pagination">
          <ul class="flex gap-4 font-mono text-xs uppercase text-gray-400">
            {% if paginate.previous %}
              <li><a href="{{ paginate.previous.url }}" class="hover:text-vinyl-blue">← Previous</a></li>
            {% endif %}
            
            <li>Page {{ paginate.current_page }} of {{ paginate.pages }}</li>
            
            {% if paginate.next %}
              <li><a href="{{ paginate.next.url }}" class="hover:text-vinyl-blue">Next →</a></li>
            {% endif %}
          </ul>
        </nav>
    </div>
  {% else %}
    <div class="py-16 flex justify-center border-b border-vinyl-blue">
        <span class="font-mono text-xs text-gray-400 uppercase">End of List</span>
    </div>
  {% endif %}

</section>

{% endpaginate %}

{% schema %}
{
  "name": "Collection Grid",
  "tag": "section",
  "class": "section-collection",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 12,
      "label": "Products per page"
    },
    {
      "type": "checkbox",
      "id": "show_subtitle",
      "default": true,
      "label": "Show Subtitle (Metafield)"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "presets": [
    {
      "name": "Collection Grid"
    }
  ]
}
{% endschema %}