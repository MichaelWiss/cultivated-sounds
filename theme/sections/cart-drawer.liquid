<cart-drawer class="drawer relative z-[70]">
  <div id="CartDrawer" class="fixed inset-0 z-[70] hidden">
    <!-- Overlay -->
    <div class="drawer__overlay fixed inset-0 bg-vinyl-black/60 backdrop-blur-sm" onclick="this.closest('cart-drawer').close()"></div>

    <!-- Drawer Content -->
    <div 
      class="drawer__inner fixed top-0 right-0 h-full w-full max-w-md bg-vinyl-paper shadow-2xl border-l border-vinyl-blue flex flex-col transform transition-transform duration-500 ease-out translate-x-full"
      role="dialog"
      aria-modal="true"
      aria-label="{{ 'sections.cart.title' | t }}"
      tabindex="-1"
    >
      
      <!-- Header -->
      <div class="flex justify-between items-center p-6 border-b border-vinyl-blue">
        <h2 class="font-serif text-2xl italic text-vinyl-blue">
          {{ 'sections.cart.title' | t }} ({{ cart.item_count }})
        </h2>
        <button 
          class="drawer__close hover:rotate-90 transition-transform duration-300" 
          onclick="this.closest('cart-drawer').close()"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          {% render 'icon-close' %}
        </button>
      </div>

      <!-- Items -->
      <div class="drawer__body flex-1 overflow-y-auto p-6 space-y-6">
        {%- if cart == empty -%}
          <div class="h-full flex flex-col items-center justify-center text-gray-400 space-y-4">
            <span class="font-serif text-xl italic">{{ 'sections.cart.empty' | t }}</span>
            <button 
              class="font-mono text-xs uppercase underline hover:text-vinyl-blue"
              onclick="this.closest('cart-drawer').close()"
            >
              {{ 'general.continue_shopping' | t }}
            </button>
          </div>
        {%- else -%}
          <form action="{{ routes.cart_url }}" method="post" id="CartDrawer-Form" class="cart__contents">
            {%- for item in cart.items -%}
              <div id="CartDrawer-Item-{{ item.index | plus: 1 }}" class="flex gap-4">
                <div class="w-20 h-20 border border-gray-200 flex-shrink-0">
                  {% if item.image %}
                    {{ item.image | image_url: width: 200 | image_tag: class: 'w-full h-full object-cover', loading: 'lazy' }}
                  {% endif %}
                </div>
                <div class="flex-1 flex flex-col justify-between">
                  <div class="flex justify-between items-start">
                    <div>
                      <h3 class="font-serif text-lg leading-none mb-1">{{ item.product.vendor }}</h3>
                      <p class="text-xs text-gray-500 font-mono">{{ item.product.title }}</p>
                      {%- unless item.product.has_only_default_variant -%}
                        <p class="text-[10px] text-gray-400 font-mono uppercase mt-1">{{ item.variant.title }}</p>
                      {%- endunless -%}
                    </div>
                    <p class="font-mono text-sm">{{ item.final_line_price | money }}</p>
                  </div>
                  
                  <div class="flex justify-between items-center mt-2">
                    <div class="flex items-center border border-gray-300 h-8">
                      <button 
                        type="button"
                        class="px-2 hover:bg-gray-100 text-vinyl-blue"
                        onclick="this.closest('cart-drawer').changeQuantity('{{ item.key }}', {{ item.quantity | minus: 1 }})"
                        name="minus"
                        aria-label="{{ 'products.product.quantity.decrease' | t: product: item.product.title | escape }}"
                      >
                        {% render 'icon-minus' %}
                      </button>
                      <span class="px-2 font-mono text-xs min-w-[1.5rem] text-center">{{ item.quantity }}</span>
                      <button 
                        type="button"
                        class="px-2 hover:bg-gray-100 text-vinyl-blue"
                        onclick="this.closest('cart-drawer').changeQuantity('{{ item.key }}', {{ item.quantity | plus: 1 }})"
                        name="plus"
                        aria-label="{{ 'products.product.quantity.increase' | t: product: item.product.title | escape }}"
                      >
                        {% render 'icon-plus' %}
                      </button>
                    </div>
                    <button 
                      type="button"
                      class="text-gray-400 hover:text-red-500 transition-colors"
                      onclick="this.closest('cart-drawer').changeQuantity('{{ item.key }}', 0)"
                      aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                    >
                      {% render 'icon-remove' %}
                    </button>
                  </div>
                </div>
              </div>
            {%- endfor -%}
          </form>
        {%- endif -%}
      </div>

      <!-- Footer -->
      {%- if cart != empty -%}
        <div class="drawer__footer border-t border-vinyl-blue p-6 bg-white">
          <div class="flex justify-between items-center mb-4">
            <span class="font-mono text-sm uppercase tracking-widest text-gray-500">{{ 'sections.cart.subtotal' | t }}</span>
            <span class="font-mono text-xl text-vinyl-black">{{ cart.total_price | money }}</span>
          </div>
          <p class="font-sans text-xs text-gray-500 mb-6 text-center">{{ 'sections.cart.taxes_and_shipping_at_checkout' | t }}</p>
          <button 
            type="submit" 
            id="CartDrawer-Checkout" 
            class="w-full bg-vinyl-blue text-white font-mono text-sm uppercase py-4 hover:bg-vinyl-black transition-colors tracking-widest" 
            name="checkout" 
            form="CartDrawer-Form"
          >
            {{ 'sections.cart.checkout' | t }}
          </button>
        </div>
      {%- endif -%}
    </div>
  </div>
</cart-drawer>

<script src="{{ 'cart-drawer.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Cart Drawer",
  "settings": []
}
{% endschema %}
