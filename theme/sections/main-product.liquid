{% comment %}
  Main Product Section
  - Ported from ProductDetail.tsx and ProductForm.tsx
  - Uses Tailwind CSS for styling
{% endcomment %}

<section class="bg-vinyl-paper min-h-screen pb-32">
  
  {% comment %} Breadcrumb / Back {% endcomment %}
  <div class="border-b border-vinyl-blue px-4 sm:px-8 py-4 flex items-center justify-between sticky top-[64px] sm:top-[80px] z-30 bg-vinyl-paper/95 backdrop-blur-sm">
    <a href="{{ routes.all_products_collection_url }}" class="flex items-center gap-2 font-mono text-xs uppercase tracking-widest text-vinyl-blue hover:underline decoration-vinyl-blue underline-offset-4">
      ← Back to Shop
    </a>
    <div class="hidden sm:flex gap-4 font-mono text-xs text-gray-400 uppercase">
       <span>Catalog #{{ product.metafields.my_fields.catalog_number | default: 'N/A' }}</span>
       <span>/</span>
       <span>{{ product.vendor | default: 'Independent' }}</span>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 min-h-[calc(100vh-140px)]">
    
    {% comment %} Left Column: Media (Sticky) {% endcomment %}
    <div class="lg:col-span-7 border-b lg:border-b-0 lg:border-r border-vinyl-blue relative">
        <div class="lg:sticky lg:top-[140px] h-auto lg:h-[calc(100vh-140px)] overflow-hidden flex flex-col">
            <div class="flex-1 bg-gray-100 relative group overflow-hidden border-b border-vinyl-blue">
                {% if product.featured_media %}
                  <img 
                      src="{{ product.featured_media | image_url: width: 1200 }}" 
                      alt="{{ product.featured_media.alt | escape }}" 
                      width="{{ product.featured_media.width }}"
                      height="{{ product.featured_media.height }}"
                      class="pdp-image w-full h-full object-cover transition-transform duration-[4s] ease-in-out hover:scale-105"
                  >
                {% endif %}
                <div class="absolute bottom-6 left-6 right-6 flex justify-between items-end opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                     <button class="bg-vinyl-paper px-3 py-1 text-[10px] font-mono uppercase tracking-widest border border-vinyl-blue shadow-sm text-vinyl-blue">
                        View Hi-Res
                     </button>
                </div>
            </div>
            {% comment %} Secondary Images Strip {% endcomment %}
            <div class="h-32 bg-white flex overflow-x-auto divide-x divide-vinyl-blue no-scrollbar">
                 {% for media in product.media %}
                   <div class="w-32 flex-shrink-0 relative cursor-pointer opacity-50 hover:opacity-100 transition-opacity">
                      <img src="{{ media | image_url: width: 200 }}" class="w-full h-full object-cover grayscale">
                   </div>
                 {% endfor %}
                 <div class="w-32 flex-shrink-0 relative cursor-pointer hover:opacity-80 transition-opacity bg-vinyl-black flex items-center justify-center">
                    {% comment %} Disc Icon {% endcomment %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
                 </div>
                 <div class="w-32 flex-shrink-0 relative cursor-pointer hover:opacity-80 transition-opacity bg-vinyl-blue/10 flex items-center justify-center">
                    <span class="font-mono text-[10px] text-vinyl-blue">Back Cover</span>
                 </div>
            </div>
        </div>
    </div>

    {% comment %} Right Column: Details (Scrollable) {% endcomment %}
    <div class="lg:col-span-5 bg-vinyl-paper">
        <div class="p-6 sm:p-10 lg:p-12 flex flex-col gap-10">
            
            {% comment %} Header Info {% endcomment %}
            <div class="pdp-animate-up">
                <div class="flex flex-wrap gap-x-6 gap-y-2 mb-4 font-mono text-xs uppercase tracking-widest text-gray-500">
                    {% if product.vendor %}
                      <span class="text-vinyl-blue">Label: {{ product.vendor }}</span>
                    {% endif %}
                    {% if product.tags.size > 0 %}
                      <span>File Under: {{ product.tags | join: ' / ' }}</span>
                    {% endif %}
                </div>
                
                <h1 class="font-serif text-4xl sm:text-5xl lg:text-6xl text-vinyl-blue leading-[0.9] mb-2">
                    <span class="block text-vinyl-black mb-2 text-2xl sm:text-3xl font-sans font-normal tracking-wide">{{ product.metafields.my_fields.artist | default: product.vendor }} —</span>
                    <span class="italic">{{ product.title }}</span>
                </h1>
                
                <div class="mt-6 flex items-center gap-4">
                    <span class="font-mono text-2xl text-vinyl-black">{{ product.price | money }}</span>
                    {% if product.available == false %}
                       <span class="px-3 py-1 rounded-full border border-gray-400 text-gray-400 text-[10px] font-mono uppercase">Sold Out</span>
                    {% elsif product.tags contains 'New' %}
                       <span class="px-3 py-1 rounded-full border border-vinyl-blue text-vinyl-blue text-[10px] font-mono uppercase">New Arrival</span>
                    {% endif %}
                </div>
            </div>

            {% comment %} Actions / Product Form {% endcomment %}
            <div class="pdp-animate-up border-y border-gray-300 py-8">
               
               {% form 'product', product, class: 'product-form flex flex-col gap-6' %}
                 <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                 
                 {% comment %} Variant Picker {% endcomment %}
                 {% unless product.has_only_default_variant %}
                   <div class="flex flex-col gap-2">
                     <span class="font-mono text-[10px] uppercase text-gray-500 tracking-widest">Format</span>
                     <div class="flex gap-2">
                        {% for variant in product.variants %}
                          <div class="relative">
                            <input 
                              type="radio" 
                              name="id" 
                              value="{{ variant.id }}" 
                              id="variant-{{ variant.id }}"
                              class="peer sr-only"
                              {% if product.selected_or_first_available_variant.id == variant.id %}checked{% endif %}
                            >
                            <label 
                              for="variant-{{ variant.id }}"
                              class="block px-4 py-2 border font-mono text-xs uppercase transition-colors cursor-pointer
                                     peer-checked:bg-vinyl-blue peer-checked:text-white peer-checked:border-vinyl-blue
                                     bg-transparent border-gray-300 text-gray-500 hover:border-vinyl-blue"
                            >
                                {{ variant.title }}
                            </label>
                          </div>
                        {% endfor %}
                     </div>
                   </div>
                 {% endunless %}

                 <div class="flex gap-4">
                      {% comment %} Quantity {% endcomment %}
                      <div class="flex items-center border border-vinyl-blue h-12 w-32 bg-white">
                          <button type="button" class="w-10 h-full flex items-center justify-center hover:bg-gray-100 text-vinyl-blue" onclick="this.nextElementSibling.stepDown()">
                              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/></svg>
                          </button>
                          <input 
                              type="number" 
                              name="quantity" 
                              value="1" 
                              min="1"
                              class="w-full h-full text-center font-mono text-sm border-x border-gray-100 focus:outline-none appearance-none" 
                          >
                          <button type="button" class="w-10 h-full flex items-center justify-center hover:bg-gray-100 text-vinyl-blue" onclick="this.previousElementSibling.stepUp()">
                              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                          </button>
                      </div>
                      
                      <button 
                          type="submit"
                          name="add"
                          {% unless product.available %}disabled{% endunless %}
                          class="flex-1 text-white transition-all h-12 flex items-center justify-center gap-3 font-mono text-xs uppercase tracking-widest shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] border border-transparent
                          {% unless product.available %}bg-gray-400 cursor-not-allowed{% else %}bg-vinyl-blue hover:bg-vinyl-black{% endunless %}"
                      >
                          <span>{% if product.available %}Add to Cart{% else %}Sold Out{% endif %}</span>
                          {% if product.available %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                          {% endif %}
                      </button>
                  </div>
               {% endform %}
               
               <div class="flex flex-col gap-2 font-mono text-[10px] text-gray-500 uppercase tracking-wide mt-6">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-vinyl-blue"><rect width="16" height="13" x="4" y="5" rx="2"/><path d="M16 2v3"/><path d="M8 2v3"/><circle cx="9" cy="14" r="2"/><circle cx="15" cy="14" r="2"/></svg>
                        <span>Free shipping on US orders over $100</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-vinyl-blue"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                        <span>Pickup available at Brooklyn Store (Ready in 24h)</span>
                    </div>
                </div>
            </div>

            {% comment %} Description {% endcomment %}
            <div class="pdp-animate-up prose prose-headings:font-serif prose-p:font-sans prose-p:text-sm prose-p:leading-relaxed prose-a:text-vinyl-blue text-gray-800 max-w-none">
                <h3 class="font-serif text-2xl italic text-vinyl-blue mb-4">About the Release</h3>
                <div class="rte">
                  {{ product.description }}
                </div>
            </div>

            {% comment %} Tracklist (Placeholder for Phase 3/4) {% endcomment %}
            <div class="pdp-animate-up" data-audio-player-container>
                 <div class="flex justify-between items-end border-b border-vinyl-blue pb-2 mb-4">
                     <h3 class="font-serif text-2xl italic text-vinyl-blue">Tracklist</h3>
                     {% comment %} We assume tracks are stored in a JSON metafield for now, or just placeholders {% endcomment %}
                     <span class="font-mono text-[10px] uppercase text-gray-500">Tracks</span>
                 </div>
                 <ul class="flex flex-col">
                     {% comment %} 
                        Example loop if using metafields:
                        {% for track in product.metafields.custom.tracklist.value %}
                     {% endcomment %}
                     {% for i in (1..5) %}
                         <li 
                            class="group flex justify-between items-center py-3 border-b border-gray-200 hover:pl-2 transition-all cursor-pointer hover:bg-white"
                            data-track-index="{{ forloop.index0 }}"
                            data-audio-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"
                         >
                             <div class="flex items-center gap-4">
                                 <span class="font-mono text-xs text-gray-400 w-6 flex justify-center">{{ forloop.index }}</span>
                                 <span class="font-sans text-sm group-hover:text-vinyl-blue">Track Title {{ forloop.index }}</span>
                             </div>
                             <div class="flex items-center gap-4">
                                <span class="font-mono text-xs text-gray-400">3:45</span>
                                <button class="text-vinyl-blue opacity-0 group-hover:opacity-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                                </button>
                             </div>
                         </li>
                     {% endfor %}
                 </ul>
            </div>
            
            {% comment %} Extras Upsell {% endcomment %}
            <div class="pdp-animate-up bg-[#e8e6df] p-6 border border-vinyl-blue mt-8">
                 <h4 class="font-serif text-xl italic text-vinyl-blue mb-4">Cultivated Sounds Extras</h4>
                 <div class="flex gap-4">
                    <div class="w-16 h-16 bg-white border border-gray-300 flex items-center justify-center flex-shrink-0">
                        <span class="font-mono text-[8px] text-center">OUTER<br/>SLEEVE</span>
                    </div>
                    <div class="flex-1">
                        <p class="font-mono text-xs font-bold uppercase mb-1">12" Outer Sleeves - Dual Pocket</p>
                        <p class="font-sans text-xs text-gray-600 mb-2">Protect your investment with our premium 3mil sleeves.</p>
                        <div class="flex justify-between items-center">
                            <span class="font-mono text-xs">$1.25</span>
                            <button class="text-[10px] uppercase font-bold text-vinyl-blue underline hover:no-underline">Add</button>
                        </div>
                    </div>
                 </div>
            </div>

        </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Product Information",
  "tag": "section",
  "class": "section-product",
  "settings": [],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "presets": [
    {
      "name": "Product Information"
    }
  ]
}
{% endschema %}